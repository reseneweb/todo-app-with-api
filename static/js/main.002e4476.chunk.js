(this["webpackJsonpreact-typescript-starter-pack"]=this["webpackJsonpreact-typescript-starter-pack"]||[]).push([[0],{18:function(e,t,n){},21:function(e,t,n){"use strict";n.r(t);var o=n(10),c=n(1),r=n.n(c),a=(n(16),n(17),n(18),n(4)),s=n(2),l=n(0),i="https://mate.academy/students-api";function d(e){return new Promise((function(t){setTimeout(t,e)}))}function u(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"GET",n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,o={method:t};return n&&(o.body=JSON.stringify(n),o.headers={"Content-Type":"application/json; charset=UTF-8"}),d(100).then((function(){return fetch(i+e,o)})).then((function(e){if(!e.ok)throw new Error;return e.json()}))}var f,p=function(e){return u(e)},b=function(e,t){return u(e,"POST",t)},j=function(e,t){return u(e,"PATCH",t)},m=function(e){return u(e,"DELETE")},h=function(e){return m("/todos/".concat(e))},O=function(e){var t=e.id,n=e.userId,o=e.title,c=e.completed;return j("/todos/".concat(t),{userId:n,title:o,completed:c})},v=n(11),x=n(3),y=n.n(x),T=function(e){var t=e.todos,n=e.setTodos,o=e.USER_ID,r=e.toggleAll,a=e.handleToggleAll,i=e.setErrorMessage,d=e.tempTodo,u=e.setTempTodo,f=e.focusedInput,p=Object(c.useState)(""),j=Object(s.a)(p,2),m=j[0],h=j[1],O=Object(c.useState)(!1),x=Object(s.a)(O,2),T=x[0],_=x[1],g=Object(c.useRef)(null);function k(e){var o=e.userId,c=e.title,r=e.completed,a=Date.now();u({userId:o,title:c,completed:r,id:a}),_(!0),i(""),function(e){var t=e.userId,n=e.title,o=e.completed;return b("/todos",{userId:t,title:n,completed:o})}({userId:o,title:c,completed:r}).then((function(e){n([].concat(Object(v.a)(t),[e])),u(null),h("")})).catch((function(){i("Unable to add a todo"),u(null)})).finally((function(){_(!1)}))}Object(c.useEffect)((function(){g.current&&null===d&&g.current.focus()}),[d]),Object(c.useEffect)((function(){var e;f&&(null===(e=g.current)||void 0===e||e.focus())}),[f]);return Object(l.jsxs)("header",{className:"todoapp__header",children:[!!t.length&&Object(l.jsx)("button",{"aria-label":"button",type:"button",className:y()("todoapp__toggle-all",{active:r}),"data-cy":"ToggleAllButton",onClick:a}),Object(l.jsx)("form",{onSubmit:function(e){e.preventDefault(),m.trim()?k({id:t.length,userId:o,title:m.trim(),completed:!1}):i("Title should not be empty")},children:Object(l.jsx)("input",{"data-cy":"NewTodoField",type:"text",className:"todoapp__new-todo",placeholder:"What needs to be done?",value:m,onChange:function(e){h(e.target.value)},ref:g,disabled:T})})]})};!function(e){e.all="All",e.active="Active",e.completed="Completed"}(f||(f={}));var _=n(6),g=n.n(_),k=n(9),N=function(e){var t=e.todo,n=e.todos,o=e.setTodos,r=e.setErrorMessage,i=e.USER_ID,d=e.setFocusedInput,u=Object(c.useState)(!1),f=Object(s.a)(u,2),p=f[0],b=f[1],j=Object(c.useState)(null),m=Object(s.a)(j,2),v=m[0],x=m[1],T=Object(c.useState)(t.title.trim()),_=Object(s.a)(T,2),N=_[0],E=_[1],I=Object(c.useRef)(null);function S(e){return n.find((function(t){return t.id===e}))||null}Object(c.useEffect)((function(){I.current&&p&&I.current.focus()}),[p]);var C=function(e){r(""),x(e),d(!1),h(e).then((function(){var t=n.filter((function(t){return t.id!==e}));o(t),b(!1)})).catch((function(){r("Unable to delete a todo"),x(null),d(!0)})).finally((function(){x(null),d(!0)}))},w=function(){var e=Object(k.a)(g.a.mark((function e(c){var a,s;return g.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if("Enter"===c||"Escape"===c){e.next=2;break}return e.abrupt("return");case 2:if(null===v){e.next=4;break}return e.abrupt("return");case 4:if(a=S(t.id)){e.next=7;break}return e.abrupt("return");case 7:if("Escape"!==c){e.next=11;break}return E(a.title),b(!1),e.abrupt("return");case 11:if("Enter"!==c){e.next=34;break}if(""!==N.trim()){e.next=15;break}return C(t.id),e.abrupt("return");case 15:if(N.trim()!==t.title.trim()){e.next=18;break}return b(!1),e.abrupt("return");case 18:return x(t.id),r(""),e.prev=20,e.next=23,O({id:t.id,userId:i,title:N.trim(),completed:t.completed});case 23:s=e.sent,o(n.map((function(e){return e.id===s.id?s:e}))),e.next=30;break;case 27:e.prev=27,e.t0=e.catch(20),r("Unable to update a todo");case 30:return e.prev=30,x(null),b(!1),e.finish(30);case 34:case"end":return e.stop()}}),e,null,[[20,27,30,34]])})));return function(t){return e.apply(this,arguments)}}(),F=function(){var e=Object(k.a)(g.a.mark((function e(){return g.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!p){e.next=4;break}return e.next=3,w("Enter");case 3:b(!1);case 4:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}();return Object(l.jsxs)("div",{"data-cy":"Todo",className:y()("todo",{completed:t.completed}),children:[Object(l.jsx)("label",{className:"todo__status-label",children:Object(l.jsx)("input",{"data-cy":"TodoStatus",type:"checkbox",className:"todo__status",checked:t.completed,onClick:function(){r(""),x(t.id),O({id:t.id,userId:i,title:t.title,completed:!t.completed}).then((function(e){o(n.map((function(t){return t.id===e.id?Object(a.a)(Object(a.a)({},t),{},{completed:!t.completed}):t})))})).catch((function(e){throw r("Unable to update a todo"),e})).finally((function(){x(null)}))}})}),p?Object(l.jsx)("form",{children:Object(l.jsx)("input",{"data-cy":"TodoTitleField",type:"text",className:"todo__title-field",placeholder:"Empty todo will be deleted",ref:I,value:N,onChange:function(e){E(null===e||void 0===e?void 0:e.target.value)},onKeyDown:function(e){"Enter"!==e.key&&"Escape"!==e.key||(e.preventDefault(),w(e.key))},onBlur:F})}):Object(l.jsxs)(l.Fragment,{children:[Object(l.jsx)("span",{"data-cy":"TodoTitle",className:"todo__title",onDoubleClick:function(){return b(!0)},children:t.title}),Object(l.jsx)("button",{type:"button",className:"todo__remove","data-cy":"TodoDelete",onClick:function(){return C(t.id)},children:"\xd7"})]}),Object(l.jsxs)("div",{"data-cy":"TodoLoader",className:y()("modal overlay",{"is-active":v===t.id}),children:[Object(l.jsx)("div",{className:"modal-background has-background-white-ter"}),Object(l.jsx)("div",{className:"loader"})]})]})},E=r.a.memo((function(e){var t=e.filteredTodos,n=e.tempTodo,o=e.setFocusedInput,c=e.todos,r=e.setTodos,a=e.setErrorMessage,s=e.USER_ID;return Object(l.jsxs)("section",{className:"todoapp__main","data-cy":"TodoList",children:[t.map((function(e){return Object(l.jsx)(N,{todo:e,todos:c,setTodos:r,setErrorMessage:a,USER_ID:s,setFocusedInput:o},e.id)})),null!==n&&Object(l.jsxs)("div",{"data-cy":"Todo",className:y()("todo",{completed:n.completed}),children:[Object(l.jsx)("label",{className:"todo__status-label",children:Object(l.jsx)("input",{"data-cy":"TodoStatus",type:"checkbox",className:"todo__status",checked:n.completed})}),Object(l.jsx)("span",{"data-cy":"TodoTitle",className:"todo__title",children:n.title}),Object(l.jsx)("button",{type:"button",className:"todo__remove","data-cy":"TodoDelete",children:"\xd7"}),Object(l.jsxs)("div",{"data-cy":"TodoLoader",className:"modal overlay is-active",children:[Object(l.jsx)("div",{className:"modal-background has-background-white-ter"}),Object(l.jsx)("div",{className:"loader"})]})]})]})})),I=function(e){var t=e.filteredBy,n=e.setFilteredBy,o=function(e){return function(){n(e)}};return Object(l.jsxs)("nav",{className:"filter","data-cy":"Filter",children:[Object(l.jsx)("a",{href:"#/","data-cy":"FilterLinkAll",className:y()("filter__link",{selected:t===f.all}),onClick:o(f.all),children:f.all}),Object(l.jsx)("a",{href:"#/active","data-cy":"FilterLinkActive",className:y()("filter__link",{selected:t===f.active}),onClick:o(f.active),children:f.active}),Object(l.jsx)("a",{href:"#/completed","data-cy":"FilterLinkCompleted",className:y()("filter__link",{selected:t===f.completed}),onClick:o(f.completed),children:f.completed})]})},S=function(e){var t=e.numberOfNotCompleted,n=e.filteredBy,o=e.setFilteredBy,c=e.todos,r=e.setTodos,a=e.setErrorMessage,s=e.setFocusedInput;return Object(l.jsxs)("footer",{className:"todoapp__footer","data-cy":"Footer",children:[Object(l.jsx)("span",{className:"todo-count","data-cy":"TodosCounter",children:"".concat(t," items left")}),Object(l.jsx)(I,{filteredBy:n,setFilteredBy:o}),Object(l.jsx)("button",{type:"button",className:"todoapp__clear-completed","data-cy":"ClearCompletedButton",onClick:function(){a(""),s(!1);var e=c.filter((function(e){return e.completed})),t=e.map((function(e){return h(e.id).then((function(){return{id:e.id,success:!0}})).catch((function(){return a("Unable to delete a todo"),{id:e.id,success:!1}}))}));Promise.all(t).then((function(t){var n=t.filter((function(e){return e.success})).map((function(e){return e.id}));r(c.filter((function(t){return!n.includes(t.id)||!e.some((function(e){return e.id===t.id}))})))})).finally((function(){return s(!0)}))},disabled:c.length===t,children:"Clear completed"})]})},C=11681,w=function(){var e=Object(c.useState)([]),t=Object(s.a)(e,2),n=t[0],o=t[1],r=Object(c.useState)(f.all),i=Object(s.a)(r,2),d=i[0],u=i[1],b=Object(c.useState)(!1),j=Object(s.a)(b,2),m=j[0],h=j[1],v=n.filter((function(e){return!e.completed})).length,x=Object(c.useState)(""),y=Object(s.a)(x,2),_=y[0],g=y[1],k=Object(c.useState)(null),N=Object(s.a)(k,2),I=N[0],w=N[1],F=Object(c.useState)(!1),D=Object(s.a)(F,2),U=D[0],B=D[1],A=d===f.all?n:n.filter((function(e){switch(d){case f.active:return!e.completed;case f.completed:return e.completed;default:return!0}}));Object(c.useEffect)((function(){var e;(e=C,p("/todos?userId=".concat(e))).then(o).catch((function(){return g("Unable to load todos")}))}),[]),Object(c.useEffect)((function(){h(!v&&!!n.length)}),[v,n.length]);return Object(c.useEffect)((function(){if(_){var e=setTimeout((function(){g("")}),3e3);return function(){clearTimeout(e)}}return function(){}}),[_]),Object(l.jsxs)("div",{className:"todoapp",children:[Object(l.jsx)("h1",{className:"todoapp__title",children:"todos"}),Object(l.jsxs)("div",{className:"todoapp__content",children:[Object(l.jsx)(T,{todos:n,setTodos:o,USER_ID:C,toggleAll:m,handleToggleAll:function(){var e=!m,t=n.filter((function(t){return t.completed!==e})).map((function(t){return O(Object(a.a)(Object(a.a)({},t),{},{completed:e})).then((function(e){return e})).catch((function(e){throw g("Unable to update a todo"),e}))}));Promise.all(t).then((function(e){var t=n.map((function(t){return e.find((function(e){return e.id===t.id}))||t}));o(t)}))},setErrorMessage:g,tempTodo:I,setTempTodo:w,focusedInput:U}),!!n.length&&Object(l.jsxs)(l.Fragment,{children:[Object(l.jsx)(E,{filteredTodos:A,tempTodo:I,setFocusedInput:B,todos:n,setTodos:o,setErrorMessage:g,USER_ID:C}),Object(l.jsx)(S,{numberOfNotCompleted:v,filteredBy:d,setFilteredBy:u,todos:n,setTodos:o,setErrorMessage:g,setFocusedInput:B})]})]}),Object(l.jsxs)("div",{"data-cy":"ErrorNotification",className:"notification is-danger is-light has-text-weight-normal ".concat(!_&&"hidden"),children:[Object(l.jsx)("button",{"data-cy":"HideErrorButton",type:"button",className:"delete",onClick:function(){return g("")}}),_]})]})},F=document.getElementById("root");Object(o.render)(Object(l.jsx)(w,{}),F)}},[[21,1,2]]]);
//# sourceMappingURL=main.002e4476.chunk.js.map